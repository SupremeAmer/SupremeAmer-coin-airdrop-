<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SupremeAmer Wallet | Complete Crypto Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.4.0/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
    /* CSS will be placed here - shortened for brevity */
    :root {
        --primary: #FFB800;
        --primary-dark: #E6A600;
        --secondary: #FF8A00;
        --accent: #FF3860;
        --success: #23D160;
        --warning: #FFDD57;
        --dark-bg: #121212;
        --dark-card: #1E1E1E;
        --dark-surface: #2D2D2D;
        --light-bg: #F8F9FA;
        --light-card: #FFFFFF;
        --light-surface: #F1F3F4;
        --text-dark: #FFFFFF;
        --text-light: #333333;
        --text-secondary: #888888;
        --shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        --radius: 16px;
        --positive: #00D1B2;
        --negative: #FF3860;
        --gradient-primary: linear-gradient(135deg, #FF8A00 0%, #FFB800 100%);
        --gradient-secondary: linear-gradient(135deg, #FF3860 0%, #FF8A00 100%);
        --gradient-light: linear-gradient(135deg, #87CEEB 0%, #B0E2FF 100%);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Montserrat', sans-serif;
        min-height: 100vh;
        background: var(--gradient-primary);
        color: var(--text-dark);
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-x: hidden;
        padding-bottom: 90px;
    }

    /* ... rest of CSS styles ... */
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        SUPREMEAMER WALLET
    </div>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Home Page -->
        <div class="page active" id="home-page">
            <!-- Wallet Card -->
            <div class="wallet-card" id="walletCard">
                <div class="wallet-header">
                    <div class="wallet-title">My Wallet</div>
                    <div class="network-badge" id="networkBadge">
                        <i class="fas fa-circle"></i>
                        <span id="networkName">Not Connected</span>
                    </div>
                </div>
                
                <div class="balance-section">
                    <button class="hide-balance-btn" id="hideBalanceBtn">
                        <i class="fas fa-eye"></i>
                    </button>
                    <div class="balance-amount" id="walletBalance">0 ETH</div>
                    <div class="balance-label">Total Balance</div>
                    <div class="currency-selector">
                        <button class="currency-btn active" data-currency="USD">USD</button>
                        <button class="currency-btn" data-currency="EUR">EUR</button>
                        <button class="currency-btn" data-currency="BTC">BTC</button>
                    </div>
                </div>
                
                <div class="wallet-actions" id="walletActions" style="display: none;">
                    <div class="action-btn" id="sendActionBtn">
                        <i class="fas fa-paper-plane"></i>
                        <span>Send</span>
                    </div>
                    <div class="action-btn" id="receiveActionBtn">
                        <i class="fas fa-qrcode"></i>
                        <span>Receive</span>
                    </div>
                    <div class="action-btn" id="swapActionBtn">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Swap</span>
                    </div>
                    <div class="action-btn" id="buyActionBtn">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Buy</span>
                    </div>
                </div>
                
                <div class="quick-actions" id="quickActions" style="display: none;">
                    <div class="quick-action-btn" id="stakingBtn">
                        <i class="fas fa-coins"></i>
                        <span>Staking</span>
                    </div>
                    <div class="quick-action-btn" id="nftBtn">
                        <i class="fas fa-images"></i>
                        <span>NFTs</span>
                    </div>
                    <div class="quick-action-btn" id="dappBtn">
                        <i class="fas fa-globe"></i>
                        <span>DApps</span>
                    </div>
                    <div class="quick-action-btn" id="earnBtn">
                        <i class="fas fa-chart-line"></i>
                        <span>Earn</span>
                    </div>
                </div>
                
                <!-- Connect Wallet Screen -->
                <div class="connect-screen" id="connectScreen">
                    <div class="connect-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="connect-title">Connect Your Wallet</div>
                    <div class="connect-description">Connect your wallet to manage your assets and make transactions</div>
                    <button class="btn btn-primary" id="connectWalletBtn">
                        <i class="fas fa-plug"></i>
                        Connect Wallet
                    </button>
                    <div class="import-export-options">
                        <div class="import-option" id="importWalletOption">
                            <i class="fas fa-file-import"></i>
                            <div class="option-details">
                                <div class="option-title">Import Wallet</div>
                                <div class="option-description">Import using private key or seed phrase</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Wallet Connected UI -->
                <div id="connectedUI" style="display: none;">
                    <div class="wallet-address" id="walletAddressSection">
                        <div class="address-text" id="walletAddress">0x0000...0000</div>
                        <button class="copy-btn" id="copyAddressBtn">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    
                    <!-- Send Section -->
                    <div class="send-section" id="sendSection">
                        <form id="sendForm">
                            <div class="form-group">
                                <label class="form-label" for="sendAmount">Amount</label>
                                <input type="number" class="form-input" id="sendAmount" placeholder="Enter amount" step="0.0001" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="recipientAddress">Recipient Address</label>
                                <input type="text" class="form-input" id="recipientAddress" placeholder="Enter recipient address" required>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-paper-plane"></i>
                                Send ETH
                            </button>
                        </form>
                        
                        <div class="status-message" id="sendMessage"></div>
                    </div>
                    
                    <!-- Receive Section -->
                    <div class="receive-section" id="receiveSection" style="display: none;">
                        <div class="qr-code-container">
                            <div class="qr-code" id="homeQrCode"></div>
                            <div class="qr-address" id="homeQrAddress">0x0000...0000</div>
                            <button class="btn btn-primary btn-block" id="copyHomeQrAddressBtn">
                                <i class="fas fa-copy"></i>
                                Copy Address
                            </button>
                        </div>
                    </div>
                    
                    <!-- Swap Section -->
                    <div class="swap-section" id="swapSection" style="display: none;">
                        <form id="swapForm">
                            <div class="form-group">
                                <label class="form-label" for="swapFrom">From</label>
                                <div class="form-input" style="display: flex; align-items: center; gap: 10px;">
                                    <input type="number" id="swapFromAmount" placeholder="0.0" style="border: none; background: none; flex: 1; color: inherit;">
                                    <select id="swapFromToken" style="border: none; background: none; color: inherit;">
                                        <option value="ETH">ETH</option>
                                        <option value="DAI">DAI</option>
                                        <option value="USDC">USDC</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin: 10px 0;">
                                <button type="button" class="btn btn-secondary" id="swapDirectionBtn" style="border-radius: 50%; width: 40px; height: 40px; padding: 0;">
                                    <i class="fas fa-exchange-alt"></i>
                                </button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="swapTo">To</label>
                                <div class="form-input" style="display: flex; align-items: center; gap: 10px;">
                                    <input type="number" id="swapToAmount" placeholder="0.0" style="border: none; background: none; flex: 1; color: inherit;" readonly>
                                    <select id="swapToToken" style="border: none; background: none; color: inherit;">
                                        <option value="DAI">DAI</option>
                                        <option value="ETH">ETH</option>
                                        <option value="USDC">USDC</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary);">
                                    <span>Rate:</span>
                                    <span id="swapRate">1 ETH = 0 DAI</span>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-exchange-alt"></i>
                                Swap Tokens
                            </button>
                        </form>
                        
                        <div class="status-message" id="swapMessage"></div>
                    </div>
                </div>
            </div>
            
            <!-- Assets Section -->
            <div class="assets-section" id="assetsSection" style="display: none;">
                <div class="settings-title">Your Assets</div>
                <div class="token-list" id="tokenList">
                    <!-- Token items will be added here dynamically -->
                </div>
            </div>
            
            <!-- Status Messages -->
            <div class="status-message" id="walletMessage"></div>
        </div>
        
        <!-- Swap Page -->
        <div class="page" id="swap-page">
            <div class="page-header">
                <button class="back-btn" id="swapPageBackBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="page-title">Swap Tokens</div>
            </div>
            
            <div class="swap-section">
                <form id="advancedSwapForm">
                    <div class="form-group">
                        <label class="form-label" for="advancedSwapFrom">From</label>
                        <div class="form-input" style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="advancedSwapFromAmount" placeholder="0.0" style="border: none; background: none; flex: 1; color: inherit;">
                            <select id="advancedSwapFromToken" style="border: none; background: none; color: inherit;">
                                <option value="ETH">ETH</option>
                                <option value="DAI">DAI</option>
                                <option value="USDC">USDC</option>
                                <option value="USDT">USDT</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 10px 0;">
                        <button type="button" class="btn btn-secondary" id="advancedSwapDirectionBtn" style="border-radius: 50%; width: 40px; height: 40px; padding: 0;">
                            <i class="fas fa-exchange-alt"></i>
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="advancedSwapTo">To</label>
                        <div class="form-input" style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="advancedSwapToAmount" placeholder="0.0" style="border: none; background: none; flex: 1; color: inherit;" readonly>
                            <select id="advancedSwapToToken" style="border: none; background: none; color: inherit;">
                                <option value="DAI">DAI</option>
                                <option value="ETH">ETH</option>
                                <option value="USDC">USDC</option>
                                <option value="USDT">USDT</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary);">
                            <span>Rate:</span>
                            <span id="advancedSwapRate">1 ETH = 0 DAI</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary); margin-top: 5px;">
                            <span>Slippage:</span>
                            <span id="advancedSwapSlippage">1%</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-exchange-alt"></i>
                        Swap Tokens
                    </button>
                </form>
                
                <div class="status-message" id="advancedSwapMessage"></div>
                
                <div class="settings-section" style="margin-top: 20px;">
                    <div class="settings-title">Swap Settings</div>
                    <div class="form-group">
                        <label class="form-label" for="slippageTolerance">Slippage Tolerance (%)</label>
                        <input type="number" class="form-input" id="slippageTolerance" value="1" min="0.1" max="50" step="0.1">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Trading Page -->
        <div class="page" id="trading-page">
            <div class="page-header">
                <button class="back-btn" id="tradingBackBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="page-title">Advanced Trading</div>
            </div>
            
            <div class="trading-section">
                <div class="trading-tabs">
                    <button class="trading-tab active" data-tab="spot">Spot</button>
                    <button class="trading-tab" data-tab="limit">Limit</button>
                </div>
                
                <div class="trading-content">
                    <!-- Spot Trading -->
                    <div class="trading-tab-content active" id="spot-tab">
                        <form id="spotForm">
                            <div class="form-group">
                                <label class="form-label" for="spotPair">Trading Pair</label>
                                <select class="form-input" id="spotPair">
                                    <option value="ETH/USD">ETH/USD</option>
                                    <option value="BTC/USD">BTC/USD</option>
                                    <option value="DAI/USD">DAI/USD</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="spotSide">Side</label>
                                <select class="form-input" id="spotSide">
                                    <option value="buy">Buy</option>
                                    <option value="sell">Sell</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="spotAmount">Amount</label>
                                <input type="number" class="form-input" id="spotAmount" placeholder="Enter amount" step="0.0001" required>
                            </div>
                            
                            <div class="form-group">
                                <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary);">
                                    <span>Estimated Cost:</span>
                                    <span id="spotCost">$0.00</span>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-exchange-alt"></i>
                                Place Order
                            </button>
                        </form>
                    </div>
                    
                    <!-- Limit Trading -->
                    <div class="trading-tab-content" id="limit-tab" style="display: none;">
                        <form id="limitForm">
                            <div class="form-group">
                                <label class="form-label" for="limitPair">Trading Pair</label>
                                <select class="form-input" id="limitPair">
                                    <option value="ETH/USD">ETH/USD</option>
                                    <option value="BTC/USD">BTC/USD</option>
                                    <option value="DAI/USD">DAI/USD</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="limitSide">Side</label>
                                <select class="form-input" id="limitSide">
                                    <option value="buy">Buy</option>
                                    <option value="sell">Sell</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="limitPrice">Limit Price ($)</label>
                                <input type="number" class="form-input" id="limitPrice" placeholder="Enter limit price" step="0.01" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="limitAmount">Amount</label>
                                <input type="number" class="form-input" id="limitAmount" placeholder="Enter amount" step="0.0001" required>
                            </div>
                            
                            <div class="form-group">
                                <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary);">
                                    <span>Total:</span>
                                    <span id="limitTotal">$0.00</span>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-exchange-alt"></i>
                                Place Limit Order
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="order-book">
                    <div class="settings-title">Order Book</div>
                    <div class="order-row">
                        <span>Price (USD)</span>
                        <span>Amount</span>
                        <span>Total</span>
                    </div>
                    <div class="order-row order-ask">
                        <span>3250.50</span>
                        <span>1.25</span>
                        <span>4063.13</span>
                    </div>
                    <div class="order-row order-ask">
                        <span>3249.75</span>
                        <span>2.10</span>
                        <span>6824.48</span>
                    </div>
                    <div class="order-row order-bid">
                        <span>3248.20</span>
                        <span>0.85</span>
                        <span>2760.97</span>
                    </div>
                    <div class="order-row order-bid">
                        <span>3247.50</span>
                        <span>3.45</span>
                        <span>11203.88</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Page -->
        <div class="page" id="settings-page">
            <div class="page-header">
                <button class="back-btn" id="settingsBackBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="page-title">Settings</div>
            </div>
            
            <div class="settings-section">
                <div class="settings-title">Wallet</div>
                <button class="btn btn-secondary btn-block" id="exportWalletBtn" style="margin-bottom: 10px;">
                    <i class="fas fa-file-export"></i>
                    Export Wallet
                </button>
                <button class="btn btn-secondary btn-block" id="importWalletSettingsBtn">
                    <i class="fas fa-file-import"></i>
                    Import Wallet
                </button>
            </div>
            
            <div class="settings-section">
                <div class="settings-title">Network</div>
                <div class="security-item">
                    <div class="security-info">
                        <div class="security-title">Current Network</div>
                        <div class="security-description" id="currentNetwork">Ethereum Mainnet</div>
                    </div>
                    <button class="btn btn-secondary" id="networkSwitcherBtn">
                        <i class="fas fa-exchange-alt"></i>
                        Switch
                    </button>
                </div>
            </div>
            
            <div class="settings-section">
                <button class="btn btn-primary btn-block" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>
    </div>
    
    <!-- Import Wallet Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Import Wallet</div>
                <button class="close-modal" id="closeImportModal">&times;</button>
            </div>
            <form id="importForm">
                <div class="form-group">
                    <label class="form-label" for="importType">Import Type</label>
                    <select class="form-input" id="importType">
                        <option value="privateKey">Private Key</option>
                        <option value="seedPhrase">Seed Phrase</option>
                    </select>
                </div>
                
                <div class="form-group" id="privateKeyGroup">
                    <label class="form-label" for="privateKey">Private Key</label>
                    <input type="password" class="form-input" id="privateKey" placeholder="Enter your private key">
                </div>
                
                <div class="form-group" id="seedPhraseGroup" style="display: none;">
                    <label class="form-label" for="seedPhrase">Seed Phrase</label>
                    <textarea class="form-input form-textarea" id="seedPhrase" placeholder="Enter your 12 or 24 word seed phrase"></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-download"></i>
                    Import Wallet
                </button>
            </form>
        </div>
    </div>
    
    <!-- Network Switcher Modal -->
    <div class="modal" id="networkModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Select Network</div>
                <button class="close-modal" id="closeNetworkModal">&times;</button>
            </div>
            <div class="network-options">
                <div class="network-option" data-network="ethereum">
                    <i class="fab fa-ethereum"></i> Ethereum Mainnet
                </div>
                <div class="network-option" data-network="bsc">
                    <i class="fas fa-chart-line"></i> BSC Mainnet
                </div>
                <div class="network-option" data-network="polygon">
                    <i class="fas fa-layer-group"></i> Polygon
                </div>
                <div class="network-option" data-network="arbitrum">
                    <i class="fas fa-bolt"></i> Arbitrum
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer Navigation -->
    <div class="footer">
        <button class="footer-btn active" data-page="home">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </button>
        <button class="footer-btn" data-page="swap">
            <i class="fas fa-exchange-alt"></i>
            <span>Swap</span>
        </button>
        <button class="footer-btn" data-page="trading">
            <i class="fas fa-chart-line"></i>
            <span>Trading</span>
        </button>
        <button class="footer-btn" data-page="settings">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </button>
    </div>

    <script>
    // Configuration
    const UNISWAP_ROUTER_ADDRESS = "0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D";
    const UNISWAP_ROUTER_ABI = [
        "function getAmountsOut(uint amountIn, address[] memory path) public view returns (uint[] memory amounts)",
        "function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) external payable returns (uint[] memory amounts)",
        "function swapExactTokensForETH(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline) external returns (uint[] memory amounts)",
        "function swapExactTokensForTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline) external returns (uint[] memory amounts)"
    ];

    // Token addresses (Ethereum Mainnet)
    const TOKEN_ADDRESSES = {
        ETH: "0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",
        DAI: "0x6B175474E89094C44Da98b954EedeAC495271d0F",
        USDC: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
        USDT: "0xdAC17F958D2ee523a2206206994597C13D831ec7"
    };

    // Wallet state
    let walletConnected = false;
    let currentAccount = null;
    let provider = null;
    let signer = null;
    let currentBalance = "0";
    let tokens = [];
    let customTokens = [];
    let balanceHidden = false;
    let selectedCurrency = "USD";
    let currentNetwork = "ethereum";
    let uniswapRouter = null;

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
        initializeApp();
    });

    // Initialize the application
    function initializeApp() {
        setupEventListeners();
        checkWalletConnection();
        setInitialTheme();
        setupDefaultTokens();
        loadCustomTokens();
        updateGasPrices();
        
        // Update gas prices every 30 seconds
        setInterval(updateGasPrices, 30000);
    }

    // Set up event listeners
    function setupEventListeners() {
        // Wallet connection
        document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);
        
        // Page navigation
        document.querySelectorAll('.footer-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const pageId = this.getAttribute('data-page');
                switchPage(pageId);
                
                document.querySelectorAll('.footer-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Back buttons
        document.getElementById('swapPageBackBtn').addEventListener('click', () => switchPage('home'));
        document.getElementById('tradingBackBtn').addEventListener('click', () => switchPage('home'));
        document.getElementById('settingsBackBtn').addEventListener('click', () => switchPage('home'));
        
        // Wallet actions
        document.getElementById('sendActionBtn').addEventListener('click', showSendSection);
        document.getElementById('receiveActionBtn').addEventListener('click', showReceiveSection);
        document.getElementById('swapActionBtn').addEventListener('click', showSwapSection);
        
        // Import options
        document.getElementById('importWalletOption').addEventListener('click', openImportModal);
        document.getElementById('importWalletSettingsBtn').addEventListener('click', openImportModal);
        
        // Form submission
        document.getElementById('importForm').addEventListener('submit', importWallet);
        document.getElementById('sendForm').addEventListener('submit', sendTokens);
        document.getElementById('swapForm').addEventListener('submit', swapTokens);
        document.getElementById('advancedSwapForm').addEventListener('submit', advancedSwap);
        document.getElementById('spotForm').addEventListener('submit', placeSpotOrder);
        document.getElementById('limitForm').addEventListener('submit', placeLimitOrder);
        
        // Trading tabs
        document.querySelectorAll('.trading-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                switchTradingTab(tabId);
                
                document.querySelectorAll('.trading-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Modal controls
        document.getElementById('closeImportModal').addEventListener('click', closeImportModal);
        document.getElementById('closeNetworkModal').addEventListener('click', closeNetworkModal);
        
        // Network switcher
        document.getElementById('networkSwitcherBtn').addEventListener('click', openNetworkModal);
        document.querySelectorAll('.network-option').forEach(option => {
            option.addEventListener('click', function() {
                switchNetwork(this.getAttribute('data-network'));
            });
        });
        
        // Swap direction
        document.getElementById('swapDirectionBtn').addEventListener('click', swapDirection);
        document.getElementById('advancedSwapDirectionBtn').addEventListener('click', advancedSwapDirection);
        
        // Close modals when clicking outside
        document.getElementById('importModal').addEventListener('click', function(e) {
            if (e.target.id === 'importModal') closeImportModal();
        });
        document.getElementById('networkModal').addEventListener('click', function(e) {
            if (e.target.id === 'networkModal') closeNetworkModal();
        });
        
        // Import type change
        document.getElementById('importType').addEventListener('change', handleImportTypeChange);
        
        // Hide balance toggle
        document.getElementById('hideBalanceBtn').addEventListener('click', toggleBalanceVisibility);
        
        // Currency selector
        document.querySelectorAll('.currency-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.currency-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedCurrency = this.getAttribute('data-currency');
                updateBalanceDisplay();
            });
        });
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', logout);
        
        // Copy address
        document.getElementById('copyAddressBtn').addEventListener('click', copyAddress);
        document.getElementById('copyHomeQrAddressBtn').addEventListener('click', copyQrAddress);
        
        // Swap amount calculation
        document.getElementById('swapFromAmount').addEventListener('input', calculateSwapAmount);
        document.getElementById('advancedSwapFromAmount').addEventListener('input', calculateAdvancedSwapAmount);
        document.getElementById('spotAmount').addEventListener('input', calculateSpotCost);
        document.getElementById('limitAmount').addEventListener('input', calculateLimitTotal);
        document.getElementById('limitPrice').addEventListener('input', calculateLimitTotal);
        
        // Slippage tolerance
        document.getElementById('slippageTolerance').addEventListener('input', updateSlippage);
        
        // MetaMask event listeners
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', handleAccountsChanged);
            window.ethereum.on('chainChanged', handleChainChanged);
        }
    }

    // Switch between pages
    function switchPage(pageId) {
        const pages = document.querySelectorAll('.page');
        pages.forEach(page => page.classList.remove('active'));
        document.getElementById(`${pageId}-page`).classList.add('active');
        
        if (pageId === 'swap') {
            calculateAdvancedSwapAmount();
        } else if (pageId === 'trading') {
            switchTradingTab('spot');
        }
    }

    // Switch trading tabs
    function switchTradingTab(tabId) {
        document.querySelectorAll('.trading-tab-content').forEach(content => {
            content.style.display = 'none';
        });
        document.getElementById(`${tabId}-tab`).style.display = 'block';
    }

    // Show send section
    function showSendSection() {
        document.getElementById('sendSection').style.display = 'block';
        document.getElementById('receiveSection').style.display = 'none';
        document.getElementById('swapSection').style.display = 'none';
        
        document.querySelectorAll('.action-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('sendActionBtn').classList.add('active');
    }

    // Show receive section
    function showReceiveSection() {
        document.getElementById('sendSection').style.display = 'none';
        document.getElementById('receiveSection').style.display = 'block';
        document.getElementById('swapSection').style.display = 'none';
        
        document.querySelectorAll('.action-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('receiveActionBtn').classList.add('active');
        
        if (walletConnected) {
            const qrCodeElement = document.getElementById('homeQrCode');
            qrCodeElement.innerHTML = '';
            
            QRCode.toCanvas(currentAccount, { width: 180, height: 180 }, function(err, canvas) {
                if (err) {
                    console.error('Error generating QR code:', err);
                    qrCodeElement.innerHTML = '<div style="color: var(--text-secondary);">QR Code Error</div>';
                    return;
                }
                qrCodeElement.appendChild(canvas);
            });
            
            document.getElementById('homeQrAddress').textContent = currentAccount;
        }
    }

    // Show swap section
    function showSwapSection() {
        document.getElementById('sendSection').style.display = 'none';
        document.getElementById('receiveSection').style.display = 'none';
        document.getElementById('swapSection').style.display = 'block';
        
        document.querySelectorAll('.action-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('swapActionBtn').classList.add('active');
        
        calculateSwapAmount();
    }

    // Calculate swap amount
    function calculateSwapAmount() {
        const fromAmount = parseFloat(document.getElementById('swapFromAmount').value) || 0;
        const fromToken = document.getElementById('swapFromToken').value;
        const toToken = document.getElementById('swapToToken').value;
        
        // Get real exchange rates from Uniswap
        getExchangeRate(fromToken, toToken, fromAmount).then(rate => {
            const toAmount = fromAmount * rate;
            document.getElementById('swapToAmount').value = toAmount.toFixed(6);
            document.getElementById('swapRate').textContent = `1 ${fromToken} = ${rate} ${toToken}`;
        }).catch(error => {
            console.error('Error getting exchange rate:', error);
            // Fallback to fixed rates
            const rates = {
                'ETH_DAI': 3200,
                'DAI_ETH': 0.0003125,
                'ETH_USDC': 3200,
                'USDC_ETH': 0.0003125,
                'DAI_USDC': 1,
                'USDC_DAI': 1
            };
            
            const rateKey = `${fromToken}_${toToken}`;
            const rate = rates[rateKey] || 1;
            const toAmount = fromAmount * rate;
            
            document.getElementById('swapToAmount').value = toAmount.toFixed(6);
            document.getElementById('swapRate').textContent = `1 ${fromToken} = ${rate} ${toToken}`;
        });
    }

    // Calculate advanced swap amount
    function calculateAdvancedSwapAmount() {
        const fromAmount = parseFloat(document.getElementById('advancedSwapFromAmount').value) || 0;
        const fromToken = document.getElementById('advancedSwapFromToken').value;
        const toToken = document.getElementById('advancedSwapToToken').value;
        
        // Get real exchange rates from Uniswap
        getExchangeRate(fromToken, toToken, fromAmount).then(rate => {
            const toAmount = fromAmount * rate;
            document.getElementById('advancedSwapToAmount').value = toAmount.toFixed(6);
            document.getElementById('advancedSwapRate').textContent = `1 ${fromToken} = ${rate} ${toToken}`;
        }).catch(error => {
            console.error('Error getting exchange rate:', error);
            // Fallback to fixed rates
            const rates = {
                'ETH_DAI': 3200,
                'DAI_ETH': 0.0003125,
                'ETH_USDC': 3200,
                'USDC_ETH': 0.0003125,
                'ETH_USDT': 3200,
                'USDT_ETH': 0.0003125,
                'DAI_USDC': 1,
                'USDC_DAI': 1,
                'DAI_USDT': 1,
                'USDT_DAI': 1,
                'USDC_USDT': 1,
                'USDT_USDC': 1
            };
            
            const rateKey = `${fromToken}_${toToken}`;
            const rate = rates[rateKey] || 1;
            const toAmount = fromAmount * rate;
            
            document.getElementById('advancedSwapToAmount').value = toAmount.toFixed(6);
            document.getElementById('advancedSwapRate').textContent = `1 ${fromToken} = ${rate} ${toToken}`;
        });
    }

    // Get exchange rate from Uniswap
    async function getExchangeRate(fromToken, toToken, amount) {
        if (!provider || fromToken === toToken) return 1;
        
        try {
            // For demo purposes, we'll use mock data
            // In a real implementation, you would use the Uniswap router
            const mockRates = {
                'ETH_DAI': 3200,
                'DAI_ETH': 0.0003125,
                'ETH_USDC': 3200,
                'USDC_ETH': 0.0003125,
                'ETH_USDT': 3200,
                'USDT_ETH': 0.0003125,
                'DAI_USDC': 1,
                'USDC_DAI': 1,
                'DAI_USDT': 1,
                'USDT_DAI': 1,
                'USDC_USDT': 1,
                'USDT_USDC': 1
            };
            
            const rateKey = `${fromToken}_${toToken}`;
            return mockRates[rateKey] || 1;
        } catch (error) {
            console.error('Error fetching exchange rate:', error);
            throw error;
        }
    }

    // Swap direction
    function swapDirection() {
        const fromToken = document.getElementById('swapFromToken').value;
        const toToken = document.getElementById('swapToToken').value;
        
        document.getElementById('swapFromToken').value = toToken;
        document.getElementById('swapToToken').value = fromToken;
        
        calculateSwapAmount();
    }

    // Advanced swap direction
    function advancedSwapDirection() {
        const fromToken = document.getElementById('advancedSwapFromToken').value;
        const toToken = document.getElementById('advancedSwapToToken').value;
        
        document.getElementById('advancedSwapFromToken').value = toToken;
        document.getElementById('advancedSwapToToken').value = fromToken;
        
        calculateAdvancedSwapAmount();
    }

    // Calculate spot cost
    function calculateSpotCost() {
        const amount = parseFloat(document.getElementById('spotAmount').value) || 0;
        const pair = document.getElementById('spotPair').value;
        
        // Simple pricing for demo
        const prices = {
            'ETH/USD': 3200,
            'BTC/USD': 45000,
            'DAI/USD': 1
        };
        
        const price = prices[pair] || 1;
        const cost = amount * price;
        
        document.getElementById('spotCost').textContent = `$${cost.toFixed(2)}`;
    }

    // Calculate limit total
    function calculateLimitTotal() {
        const amount = parseFloat(document.getElementById('limitAmount').value) || 0;
        const price = parseFloat(document.getElementById('limitPrice').value) || 0;
        const total = amount * price;
        
        document.getElementById('limitTotal').textContent = `$${total.toFixed(2)}`;
    }

    // Update slippage
    function updateSlippage() {
        const slippage = document.getElementById('slippageTolerance').value;
        document.getElementById('advancedSwapSlippage').textContent = `${slippage}%`;
    }

    // Check if wallet is already connected
    async function checkWalletConnection() {
        if (window.ethereum) {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length > 0) {
                    currentAccount = accounts[0];
                    await setupProvider();
                    updateWalletUI();
                }
            } catch (error) {
                console.error('Error checking wallet connection:', error);
            }
        }
    }

    // Connect to wallet
    async function connectWallet() {
        if (!window.ethereum) {
            showMessage('walletMessage', 'Ethereum wallet is not installed. Please install MetaMask or another Ethereum wallet.', 'error');
            return;
        }

        try {
            showMessage('walletMessage', 'Connecting to wallet...', 'info');
            document.getElementById('connectWalletBtn').disabled = true;
            document.getElementById('connectWalletBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connecting...';

            const accounts = await window.ethereum.request({ 
                method: 'eth_requestAccounts' 
            });

            currentAccount = accounts[0];
            await setupProvider();
            updateWalletUI();
            
            showMessage('walletMessage', 'Wallet connected successfully!', 'success');
            
        } catch (error) {
            console.error('Error connecting wallet:', error);
            if (error.code === 4001) {
                showMessage('walletMessage', 'Connection rejected by user.', 'error');
            } else {
                showMessage('walletMessage', 'Error connecting wallet: ' + error.message, 'error');
            }
        } finally {
            document.getElementById('connectWalletBtn').disabled = false;
            document.getElementById('connectWalletBtn').innerHTML = '<i class="fas fa-plug"></i> Connect Wallet';
        }
    }

    // Set up provider and signer
    async function setupProvider() {
        provider = new ethers.BrowserProvider(window.ethereum);
        signer = await provider.getSigner();
        
        // Set up Uniswap router contract
        uniswapRouter = new ethers.Contract(UNISWAP_ROUTER_ADDRESS, UNISWAP_ROUTER_ABI, signer);
        
        await updateBalance();
        
        const network = await provider.getNetwork();
        updateNetworkInfo(network);
        
        updateTokenBalances();
    }

    // Update wallet balance
    async function updateBalance() {
        if (!provider || !currentAccount) return;
        
        try {
            const balance = await provider.getBalance(currentAccount);
            currentBalance = ethers.formatEther(balance);
            updateBalanceDisplay();
        } catch (error) {
            console.error('Error fetching balance:', error);
        }
    }

    // Update balance display with current currency
    function updateBalanceDisplay() {
        const balanceElement = document.getElementById('walletBalance');
        const ethBalance = parseFloat(currentBalance);
        
        if (selectedCurrency === "USD") {
            const usdValue = ethBalance * 3200;
            balanceElement.textContent = `$${usdValue.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        } else if (selectedCurrency === "EUR") {
            const eurValue = ethBalance * 3200 * 0.85;
            balanceElement.textContent = `€${eurValue.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        } else if (selectedCurrency === "BTC") {
            const btcValue = ethBalance * 0.000022;
            balanceElement.textContent = `${btcValue.toFixed(6)} BTC`;
        } else {
            balanceElement.textContent = `${ethBalance.toFixed(4)} ETH`;
        }
        
        if (balanceHidden) {
            balanceElement.classList.add('balance-hidden');
        } else {
            balanceElement.classList.remove('balance-hidden');
        }
    }

    // Toggle balance visibility
    function toggleBalanceVisibility() {
        balanceHidden = !balanceHidden;
        const balanceElement = document.getElementById('walletBalance');
        const eyeIcon = document.getElementById('hideBalanceBtn').querySelector('i');
        
        if (balanceHidden) {
            balanceElement.classList.add('balance-hidden');
            eyeIcon.className = 'fas fa-eye-slash';
        } else {
            balanceElement.classList.remove('balance-hidden');
            eyeIcon.className = 'fas fa-eye';
        }
    }

    // Update network information
    function updateNetworkInfo(network) {
        let networkName = 'Unknown';
        
        switch (network.chainId) {
            case 1n:
                networkName = 'Ethereum Mainnet';
                currentNetwork = 'ethereum';
                break;
            case 5n:
                networkName = 'Goerli Testnet';
                currentNetwork = 'ethereum';
                break;
            case 56n:
                networkName = 'BNB Smart Chain';
                currentNetwork = 'bsc';
                break;
            case 137n:
                networkName = 'Polygon';
                currentNetwork = 'polygon';
                break;
            default:
                networkName = `Chain ID: ${network.chainId}`;
        }
        
        document.getElementById('networkName').textContent = networkName;
        document.getElementById('currentNetwork').textContent = networkName;
    }

    // Update wallet UI after connection
    function updateWalletUI() {
        document.getElementById('connectScreen').style.display = 'none';
        document.getElementById('connectedUI').style.display = 'block';
        document.getElementById('walletActions').style.display = 'grid';
        document.getElementById('quickActions').style.display = 'grid';
        document.getElementById('assetsSection').style.display = 'block';
        
        document.getElementById('walletAddress').textContent = 
            `${currentAccount.substring(0, 6)}...${currentAccount.substring(currentAccount.length - 4)}`;
        document.getElementById('homeQrAddress').textContent = currentAccount;
        
        walletConnected = true;
        
        showSendSection();
    }

    // Handle account changes
    function handleAccountsChanged(accounts) {
        if (accounts.length === 0) {
            disconnectWallet();
        } else if (accounts[0] !== currentAccount) {
            currentAccount = accounts[0];
            if (walletConnected) {
                updateWalletUI();
                updateBalance();
                updateTokenBalances();
            }
        }
    }

    // Handle chain changes
    function handleChainChanged(chainId) {
        window.location.reload();
    }

    // Disconnect wallet
    function disconnectWallet() {
        currentAccount = null;
        provider = null;
        signer = null;
        walletConnected = false;
        
        document.getElementById('connectScreen').style.display = 'flex';
        document.getElementById('connectedUI').style.display = 'none';
        document.getElementById('walletActions').style.display = 'none';
        document.getElementById('quickActions').style.display = 'none';
        document.getElementById('assetsSection').style.display = 'none';
        document.getElementById('walletBalance').textContent = '0 ETH';
        document.getElementById('networkName').textContent = 'Not Connected';
        
        resetTokenBalances();
        
        showMessage('walletMessage', 'Wallet disconnected', 'info');
    }

    // Show status message
    function showMessage(elementId, message, type = 'info') {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.className = `status-message status-${type}`;
        element.style.display = 'block';
        
        if (type !== 'error') {
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
    }

    // Toggle theme
    function toggleTheme() {
        const isLight = document.body.classList.contains('light');
        setTheme(!isLight);
    }

    // Set theme
    function setTheme(light) {
        if (light) {
            document.body.classList.add('light');
            localStorage.setItem('theme', 'light');
        } else {
            document.body.classList.remove('light');
            localStorage.setItem('theme', 'dark');
        }
    }

    // Set initial theme
    function setInitialTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            setTheme(true);
        } else {
            setTheme(false);
        }
    }

    // Copy address to clipboard
    function copyAddress() {
        navigator.clipboard.writeText(currentAccount).then(() => {
            showMessage('walletMessage', 'Address copied to clipboard!', 'success');
        }).catch(err => {
            console.error('Failed to copy address: ', err);
            showMessage('walletMessage', 'Failed to copy address', 'error');
        });
    }

    // Copy QR address to clipboard
    function copyQrAddress() {
        navigator.clipboard.writeText(currentAccount).then(() => {
            showMessage('walletMessage', 'Address copied to clipboard!', 'success');
        }).catch(err => {
            console.error('Failed to copy address: ', err);
            showMessage('walletMessage', 'Failed to copy address', 'error');
        });
    }

    // Send tokens
    async function sendTokens(e) {
        e.preventDefault();
        
        if (!walletConnected) {
            showMessage('sendMessage', 'Please connect your wallet first', 'error');
            return;
        }
        
        const amount = document.getElementById('sendAmount').value;
        const recipient = document.getElementById('recipientAddress').value;
        
        if (!amount || amount <= 0) {
            showMessage('sendMessage', 'Please enter a valid amount', 'error');
            return;
        }
        
        if (!ethers.isAddress(recipient)) {
            showMessage('sendMessage', 'Please enter a valid recipient address', 'error');
            return;
        }
        
        try {
            showMessage('sendMessage', 'Processing transaction...', 'info');
            
            const tx = await signer.sendTransaction({
                to: recipient,
                value: ethers.parseEther(amount)
            });
            
            await tx.wait();
            
            let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            transactions.push({
                type: 'send',
                amount: amount,
                token: 'ETH',
                recipient: recipient,
                txHash: tx.hash,
                status: 'completed',
                date: new Date().toISOString()
            });
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            await updateBalance();
            updateTokenBalances();
            
            document.getElementById('sendForm').reset();
            
            showMessage('sendMessage', `Successfully sent ${amount} ETH to ${recipient.substring(0, 6)}...${recipient.substring(recipient.length - 4)}`, 'success');
            
        } catch (error) {
            console.error('Send error:', error);
            showMessage('sendMessage', 'Transaction failed: ' + (error.message || 'Unknown error'), 'error');
        }
    }

    // Swap tokens
    async function swapTokens(e) {
        e.preventDefault();
        
        if (!walletConnected) {
            showMessage('swapMessage', 'Please connect your wallet first', 'error');
            return;
        }
        
        const fromAmount = document.getElementById('swapFromAmount').value;
        const fromToken = document.getElementById('swapFromToken').value;
        const toToken = document.getElementById('swapToToken').value;
        
        if (!fromAmount || fromAmount <= 0) {
            showMessage('swapMessage', 'Please enter a valid amount', 'error');
            return;
        }
        
        try {
            showMessage('swapMessage', 'Processing swap...', 'info');
            
            // For demo purposes, we'll simulate a swap
            // In a real implementation, you would interact with Uniswap
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            transactions.push({
                type: 'swap',
                fromAmount: fromAmount,
                fromToken: fromToken,
                toToken: toToken,
                txHash: '0x' + Math.random().toString(36).substring(2, 66),
                status: 'completed',
                date: new Date().toISOString()
            });
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            await updateBalance();
            updateTokenBalances();
            
            document.getElementById('swapForm').reset();
            
            showMessage('swapMessage', `Successfully swapped ${fromAmount} ${fromToken} to ${toToken}`, 'success');
            
        } catch (error) {
            console.error('Swap error:', error);
            showMessage('swapMessage', 'Swap failed: ' + (error.message || 'Unknown error'), 'error');
        }
    }

    // Advanced swap
    async function advancedSwap(e) {
        e.preventDefault();
        
        if (!walletConnected) {
            showMessage('advancedSwapMessage', 'Please connect your wallet first', 'error');
            return;
        }
        
        const fromAmount = document.getElementById('advancedSwapFromAmount').value;
        const fromToken = document.getElementById('advancedSwapFromToken').value;
        const toToken = document.getElementById('advancedSwapToToken').value;
        const slippage = parseFloat(document.getElementById('slippageTolerance').value) || 1;
        
        if (!fromAmount || fromAmount <= 0) {
            showMessage('advancedSwapMessage', 'Please enter a valid amount', 'error');
            return;
        }
        
        try {
            showMessage('advancedSwapMessage', 'Processing advanced swap...', 'info');
            
            // For demo purposes, we'll simulate a swap
            // In a real implementation, you would interact with Uniswap
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            transactions.push({
                type: 'swap',
                fromAmount: fromAmount,
                fromToken: fromToken,
                toToken: toToken,
                slippage: slippage,
                txHash: '0x' + Math.random().toString(36).substring(2, 66),
                status: 'completed',
                date: new Date().toISOString()
            });
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            await updateBalance();
            updateTokenBalances();
            
            document.getElementById('advancedSwapForm').reset();
            
            showMessage('advancedSwapMessage', `Successfully swapped ${fromAmount} ${fromToken} to ${toToken} with ${slippage}% slippage`, 'success');
            
        } catch (error) {
            console.error('Advanced swap error:', error);
            showMessage('advancedSwapMessage', 'Swap failed: ' + (error.message || 'Unknown error'), 'error');
        }
    }

    // Place spot order
    async function placeSpotOrder(e) {
        e.preventDefault();
        
        if (!walletConnected) {
            showMessage('walletMessage', 'Please connect your wallet first', 'error');
            return;
        }
        
        const pair = document.getElementById('spotPair').value;
        const side = document.getElementById('spotSide').value;
        const amount = document.getElementById('spotAmount').value;
        
        if (!amount || amount <= 0) {
            showMessage('walletMessage', 'Please enter a valid amount', 'error');
            return;
        }
        
        try {
            showMessage('walletMessage', 'Placing spot order...', 'info');
            
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            transactions.push({
                type: 'trade',
                pair: pair,
                side: side,
                amount: amount,
                orderType: 'spot',
                txHash: '0x' + Math.random().toString(36).substring(2, 66),
                status: 'completed',
                date: new Date().toISOString()
            });
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            document.getElementById('spotForm').reset();
            
            showMessage('walletMessage', `Successfully placed ${side} order for ${amount} ${pair.split('/')[0]}`, 'success');
            
        } catch (error) {
            console.error('Spot order error:', error);
            showMessage('walletMessage', 'Order failed: ' + (error.message || 'Unknown error'), 'error');
        }
    }

    // Place limit order
    async function placeLimitOrder(e) {
        e.preventDefault();
        
        if (!walletConnected) {
            showMessage('walletMessage', 'Please connect your wallet first', 'error');
            return;
        }
        
        const pair = document.getElementById('limitPair').value;
        const side = document.getElementById('limitSide').value;
        const price = document.getElementById('limitPrice').value;
        const amount = document.getElementById('limitAmount').value;
        
        if (!amount || amount <= 0) {
            showMessage('walletMessage', 'Please enter a valid amount', 'error');
            return;
        }
        
        if (!price || price <= 0) {
            showMessage('walletMessage', 'Please enter a valid price', 'error');
            return;
        }
        
        try {
            showMessage('walletMessage', 'Placing limit order...', 'info');
            
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            transactions.push({
                type: 'trade',
                pair: pair,
                side: side,
                amount: amount,
                price: price,
                orderType: 'limit',
                txHash: '0x' + Math.random().toString(36).substring(2, 66),
                status: 'pending',
                date: new Date().toISOString()
            });
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            document.getElementById('limitForm').reset();
            
            showMessage('walletMessage', `Successfully placed limit ${side} order for ${amount} ${pair.split('/')[0]} at $${price}`, 'success');
            
        } catch (error) {
            console.error('Limit order error:', error);
            showMessage('walletMessage', 'Order failed: ' + (error.message || 'Unknown error'), 'error');
        }
    }

    // Open import modal
    function openImportModal() {
        document.getElementById('importModal').style.display = 'flex';
    }

    // Close import modal
    function closeImportModal() {
        document.getElementById('importModal').style.display = 'none';
        document.getElementById('importForm').reset();
    }

    // Open network modal
    function openNetworkModal() {
        document.getElementById('networkModal').style.display = 'flex';
    }

    // Close network modal
    function closeNetworkModal() {
        document.getElementById('networkModal').style.display = 'none';
    }

    // Handle import type change
    function handleImportTypeChange() {
        const importType = document.getElementById('importType').value;
        
        document.getElementById('privateKeyGroup').style.display = 'none';
        document.getElementById('seedPhraseGroup').style.display = 'none';
        
        if (importType === 'privateKey') {
            document.getElementById('privateKeyGroup').style.display = 'block';
        } else if (importType === 'seedPhrase') {
            document.getElementById('seedPhraseGroup').style.display = 'block';
        }
    }

    // Import wallet
    async function importWallet(e) {
        e.preventDefault();
        
        const importType = document.getElementById('importType').value;
        
        try {
            let wallet;
            
            if (importType === 'privateKey') {
                const privateKey = document.getElementById('privateKey').value;
                if (!privateKey) {
                    showMessage('walletMessage', 'Please enter a private key', 'error');
                    return;
                }
                
                wallet = new ethers.Wallet(privateKey);
            } else if (importType === 'seedPhrase') {
                const seedPhrase = document.getElementById('seedPhrase').value;
                if (!seedPhrase) {
                    showMessage('walletMessage', 'Please enter a seed phrase', 'error');
                    return;
                }
                
                wallet = ethers.Wallet.fromPhrase(seedPhrase);
            }
            
            currentAccount = wallet.address;
            signer = wallet;
            
            updateWalletUI();
            updateBalance();
            updateTokenBalances();
            
            showMessage('walletMessage', 'Wallet imported successfully!', 'success');
            closeImportModal();
            
        } catch (error) {
            console.error('Error importing wallet:', error);
            showMessage('walletMessage', 'Error importing wallet: ' + error.message, 'error');
        }
    }

    // Switch network
    function switchNetwork(network) {
        currentNetwork = network;
        
        const networkNames = {
            'ethereum': 'Ethereum Mainnet',
            'bsc': 'BNB Smart Chain',
            'polygon': 'Polygon',
            'arbitrum': 'Arbitrum'
        };
        
        document.getElementById('networkName').textContent = networkNames[network];
        document.getElementById('currentNetwork').textContent = networkNames[network];
        
        closeNetworkModal();
        showMessage('walletMessage', `Switched to ${networkNames[network]}`, 'success');
    }

    // Load custom tokens from localStorage
    function loadCustomTokens() {
        const savedTokens = localStorage.getItem('customTokens');
        if (savedTokens) {
            customTokens = JSON.parse(savedTokens);
        }
    }

    // Update gas prices
    function updateGasPrices() {
        // Simulate gas price fluctuations
        const basePrice = 20 + Math.floor(Math.random() * 20);
        
        // Update gas price display if element exists
        const gasSlow = document.getElementById('gasSlow');
        if (gasSlow) {
            gasSlow.textContent = `${basePrice} Gwei`;
            document.getElementById('gasAverage').textContent = `${basePrice + 5} Gwei`;
            document.getElementById('gasFast').textContent = `${basePrice + 10} Gwei`;
        }
    }

    // Set up default tokens
    function setupDefaultTokens() {
        tokens = [
            {
                name: 'Ethereum',
                symbol: 'ETH',
                balance: '0',
                value: '0',
                icon: 'fab fa-ethereum'
            },
            {
                name: 'Dai Stablecoin',
                symbol: 'DAI',
                balance: '0',
                value: '0',
                icon: 'fas fa-dollar-sign'
            },
            {
                name: 'USD Coin',
                symbol: 'USDC',
                balance: '0',
                value: '0',
                icon: 'fas fa-dollar-sign'
            },
            {
                name: 'Tether',
                symbol: 'USDT',
                balance: '0',
                value: '0',
                icon: 'fas fa-coins'
            }
        ];
        
        renderTokenList();
    }

    // Render token list to the UI
    function renderTokenList() {
        const tokenList = document.getElementById('tokenList');
        
        const allTokens = [...tokens, ...customTokens];
        
        if (!allTokens || allTokens.length === 0) {
            tokenList.innerHTML = '<div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">No tokens found</div>';
            return;
        }
        
        let tokenHTML = '';
        
        allTokens.forEach(token => {
            tokenHTML += `
                <div class="token-item">
                    <div class="token-info">
                        <div class="token-icon">
                            <i class="${token.icon}"></i>
                        </div>
                        <div class="token-details">
                            <div class="token-name">${token.name}</div>
                            <div class="token-balance">${token.balance} ${token.symbol}</div>
                        </div>
                    </div>
                    <div class="token-value">
                        <div class="value-amount">$${token.value}</div>
                        <div class="value-usd">USD Value</div>
                    </div>
                </div>
            `;
        });
        
        tokenList.innerHTML = tokenHTML;
    }

    // Update token balances with real data
    async function updateTokenBalances() {
        if (!walletConnected) return;
        
        try {
            tokens[0].balance = parseFloat(currentBalance).toFixed(4);
            tokens[0].value = (parseFloat(tokens[0].balance) * 3200).toFixed(2);
            
            // For demo purposes, generate random balances for other tokens
            tokens[1].balance = (Math.random() * 10000).toFixed(2);
            tokens[1].value = tokens[1].balance;
            
            tokens[2].balance = (Math.random() * 500).toFixed(2);
            tokens[2].value = tokens[2].balance;
            
            tokens[3].balance = (Math.random() * 1000).toFixed(2);
            tokens[3].value = tokens[3].balance;
            
            customTokens.forEach(token => {
                token.balance = (Math.random() * 1000).toFixed(2);
                token.value = (parseFloat(token.balance) * (Math.random() * 10)).toFixed(2);
            });
            
            renderTokenList();
        } catch (error) {
            console.error('Error updating token balances:', error);
        }
    }

    // Reset token balances when disconnecting
    function resetTokenBalances() {
        tokens.forEach(token => {
            token.balance = '0';
            token.value = '0';
        });
        
        customTokens.forEach(token => {
            token.balance = '0';
            token.value = '0';
        });
        
        renderTokenList();
    }

    // Logout function
    function logout() {
        disconnectWallet();
        showMessage('walletMessage', 'Logged out successfully', 'success');
    }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SupremeAmer Word Connect Game</title>
  <meta name="viewport" content="width=340, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      font-family: 'Montserrat', sans-serif;
      margin: 0; padding: 0;
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
    }
    #game-container {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.14);
      max-width: 360px;
      width: 100%;
      margin: 36px auto 0 auto;
      padding: 24px 16px 24px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 560px;
      position: relative;
    }
    #mining-balance {
      background: #f6e05e;
      color: #2d3748;
      font-size: 22px;
      border-radius: 8px;
      padding: 10px 18px;
      font-weight: bold;
      margin-bottom: 10px;
      box-shadow: 0 1px 6px #f6e05e66;
      letter-spacing: 1px;
    }
    #level {
      color: #3182ce;
      font-weight: 700;
      font-size: 22px;
      margin-bottom: 10px;
      letter-spacing: 1px;
    }
    #reward-msg {
      min-height: 24px;
      font-size: 18px;
      color: #2ecc71;
      font-weight: bold;
      margin-bottom: 8px;
      transition: color .2s;
    }
    #grid {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin: 18px 0 14px 0;
    }
    .cell {
      width: 38px; height: 38px;
      display: flex; align-items: center; justify-content: center;
      background: #e3fcec;
      border: 2px solid #38b2ac;
      border-radius: 8px;
      margin: 2px;
      font-size: 26px;
      font-weight: bold;
      color: #2d3748;
      transition: background .2s, border .2s;
    }
    .cell.hint {
      background: #f6e05e;
      border-color: #ecc94b;
      color: #b7791f;
      animation: hintPulse 1s infinite alternate;
    }
    @keyframes hintPulse {
      0% { box-shadow: 0 0 0 0 #f6e05e66;}
      100% { box-shadow: 0 0 12px 4px #f6e05e44;}
    }
    #selector {
      display: flex; justify-content: center; gap: 14px; flex-wrap: wrap;
      margin: 0 0 20px 0;
      min-height: 54px;
    }
    .letter {
      width: 48px; height: 48px;
      background: #f6e05e;
      border: 2px solid #ecc94b;
      border-radius: 24px;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px; font-weight: 700;
      margin: 2px; cursor: pointer;
      transition: background .12s, transform .12s;
      user-select: none;
      box-shadow: 0 1px 6px #f6e05e33;
    }
    .letter.selected {
      background: #ffe066;
      transform: scale(0.94);
      opacity: 0.7;
    }
    #input-word {
      font-size: 26px;
      letter-spacing: 3px;
      margin-bottom: 12px;
      min-height: 30px;
      font-weight: bold;
      color: #444;
      text-align: center;
    }
    #submit-btn {
      background: linear-gradient(90deg, #38b2ac, #4299e1);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 19px;
      padding: 10px 26px;
      cursor: pointer;
      margin: 10px 0 0 0;
      font-weight: 700;
      transition: background .18s;
      box-shadow: 0 1px 6px #38b2ac44;
    }
    #submit-btn:active { background: #38b2ac; }
    #hint-btn {
      background: #ffe066;
      color: #b7791f;
      border: none;
      border-radius: 8px;
      font-size: 17px;
      padding: 9px 26px;
      cursor: pointer;
      margin: 10px 0 0 0;
      font-weight: bold;
      box-shadow: 0 1px 6px #ffe06655;
      transition: background .16s;
      margin-left: 12px;
    }
    #hint-btn:active { background: #ffed87; }
    #history-list {
      margin-top: 24px;
      width: 100%;
      max-width: 320px;
      min-height: 30px;
      text-align: left;
      font-size: 15px;
      color: #222;
    }
    .history-item {
      background: #f5f6fa;
      border-radius: 7px;
      margin-bottom: 8px;
      padding: 9px 12px;
      color: #444;
    }
    #history-btn, #restart-btn {
      background: #fff;
      color: #4299e1;
      border: 2px solid #4299e1;
      border-radius: 8px;
      font-size: 15px;
      padding: 7px 18px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 10px;
      margin-right: 10px;
      box-shadow: 0 2px 6px #4299e155;
      transition: background .12s, color .12s;
    }
    #history-btn.active, #restart-btn.active {
      background: #4299e1;
      color: #fff;
    }
    #footer-buttons {
      display: flex; justify-content: center;
      width: 100%; margin: 0; 
    }
    @media (max-width: 370px) {
      #game-container { padding: 10px; }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="mining-balance">$EARM Mining: <span id="mining-balance-value">0</span></div>
    <div id="level"></div>
    <div id="reward-msg"></div>
    <div id="grid"></div>
    <div id="input-word"></div>
    <div id="selector"></div>
    <div id="footer-buttons">
      <button id="submit-btn">SUBMIT</button>
      <button id="hint-btn">HINT (-10 $EARM)</button>
      <button id="history-btn">History</button>
      <button id="restart-btn">Restart</button>
    </div>
    <div id="history-list" style="display:none;"></div>
  </div>
<script>
/* --- WORD DATA --- */
const WORDS = [
  "nft","hide","defi","veil","skin","skrill","stock","mining","website","bitcoin",
  "secret","furtive","covert","latent","conceal","hideout","forex","stocks","secrete","stash",
  "hider","hideling","hidden","exposed","anonymous","pseudonym","incognito","mask","pokerface","cloak",
  "services","products","software","research","comments","national","internetshipping",
  "reserved","security","american","computer","download","pictures","personal","location",
  "children","students","shopping","previous","property","customer","december","training",
  "advanced","category","register","november","features","industry","provided","required",
  "articles","feedback","complete","standard","programs","language","password","question",
  "building","february","analysis","possible","problems","interest","learning","delivery",
  "original","includes","messages","provides","specific","director","planning","database",
  "official","district","calendar","resource","document","material","together","function",
  "economic","projects","included","received","archives","magazine","policies","position",
  "listings","wireless","purchase","response","practice","hardware","designed","discount",
  "remember","increase","european","activity","although","contents","regional","supplies",
  "exchange","continue","benefits","anything","mortgage","solution","addition","clothing",
  "military","decision","division"
];

/* --- GAME STATE --- */
let gameState = {
  level: 0,
  mining: 0,
  hintRevealedIdx: [],
  foundLevels: [],
  history: []
};
const LS_KEY = "supremeamer_wordgame";
function saveGame() {
  localStorage.setItem(LS_KEY, JSON.stringify(gameState));
  // Also update mining balance at index.html, if exists
  localStorage.setItem("earm_mining_balance", gameState.mining);
  window.dispatchEvent(new Event("earm_mining_update"));
}
function loadGame() {
  const data = localStorage.getItem(LS_KEY);
  if (data) {
    try {
      const obj = JSON.parse(data);
      if (typeof obj === "object") {
        gameState = {...gameState, ...obj};
      }
    } catch {}
  }
}
function resetGame() {
  gameState = {
    level: 0,
    mining: 0,
    hintRevealedIdx: [],
    foundLevels: [],
    history: []
  };
  saveGame();
  renderGame();
}

/* --- UTILITY --- */
function shuffle(array) {
  let a = array.slice();
  for (let i = a.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* --- GAME LOGIC + UI --- */
function renderGame() {
  document.getElementById("history-list").style.display = "none";
  document.getElementById("mining-balance-value").textContent = gameState.mining.toLocaleString();
  const word = WORDS[gameState.level];
  if (!word) {
    document.getElementById("level").innerHTML = `<span style="color:#38b2ac;font-size:24px;">Congratulations!<br/>You've finished all levels!</span>`;
    document.getElementById("reward-msg").textContent = "";
    document.getElementById("grid").innerHTML = "";
    document.getElementById("selector").innerHTML = "";
    document.getElementById("input-word").innerText = "";
    document.getElementById("submit-btn").disabled = true;
    document.getElementById("hint-btn").disabled = true;
    return;
  }
  document.getElementById("submit-btn").disabled = false;
  document.getElementById("hint-btn").disabled = false;
  document.getElementById("level").innerHTML = `LEVEL ${gameState.level + 1}`;
  document.getElementById("reward-msg").textContent = "";
  // Render grid (for hints)
  const gridDiv = document.getElementById("grid");
  gridDiv.innerHTML = "";
  const grid = Array.from(word.replace(/ /g, '').toUpperCase());
  for (let i = 0; i < grid.length; i++) {
    const cell = document.createElement("div");
    cell.className = "cell" + (gameState.hintRevealedIdx.includes(i) ? " hint" : "");
    cell.innerText = gameState.hintRevealedIdx.includes(i) ? grid[i] : "";
    gridDiv.appendChild(cell);
  }
  // Render selector
  const selectorDiv = document.getElementById("selector");
  selectorDiv.innerHTML = "";
  const letters = shuffle(Array.from(word.replace(/ /g, '').toUpperCase()));
  let input = "";
  letters.forEach((letter, idx) => {
    const div = document.createElement("div");
    div.className = "letter";
    div.innerText = letter;
    div.onclick = () => {
      if (!div.classList.contains("selected")) {
        div.classList.add("selected");
        input += letter;
        document.getElementById("input-word").innerText = input;
      }
    };
    selectorDiv.appendChild(div);
  });
  document.getElementById("input-word").innerText = "";
  // Submit logic
  document.getElementById("submit-btn").onclick = () => {
    if (input.replace(/ /g, '').toLowerCase() === word.replace(/ /g, '').toLowerCase()) {
      // Correct!
      const reward = 100 * (gameState.level + 1);
      gameState.mining += reward;
      gameState.foundLevels.push(gameState.level);
      gameState.level += 1;
      gameState.hintRevealedIdx = [];
      gameState.history.push({
        type: "level-up",
        level: gameState.level,
        amount: reward,
        timestamp: Date.now()
      });
      saveGame();
      document.getElementById("reward-msg").style.color = "#2ecc71";
      document.getElementById("reward-msg").innerText = `Correct! +${reward} $EARM`;
      setTimeout(renderGame, 1100);
    } else {
      document.getElementById("reward-msg").style.color = "#e74c3c";
      document.getElementById("reward-msg").innerText = "Try again!";
      document.getElementById("input-word").innerText = "";
      input = "";
      document.querySelectorAll(".letter").forEach(x => x.classList.remove("selected"));
    }
  };
  // Hint logic
  document.getElementById("hint-btn").onclick = () => {
    if (gameState.mining < 10) {
      document.getElementById("reward-msg").style.color = "#e67e22";
      document.getElementById("reward-msg").innerText = "Not enough $EARM for hint!";
      return;
    }
    let unrevealed = [];
    for (let i = 0; i < grid.length; i++) {
      if (!gameState.hintRevealedIdx.includes(i)) unrevealed.push(i);
    }
    if (unrevealed.length === 0) {
      document.getElementById("reward-msg").innerText = "All letters revealed!";
      return;
    }
    let revealCount = Math.min(2, unrevealed.length);
    for (let i = 0; i < revealCount; i++) {
      let idx = unrevealed.splice(Math.floor(Math.random() * unrevealed.length), 1)[0];
      gameState.hintRevealedIdx.push(idx);
    }
    gameState.mining -= 10;
    gameState.history.push({
      type: "hint",
      level: gameState.level,
      amount: 10,
      timestamp: Date.now()
    });
    saveGame();
    renderGame();
  };
}

/* --- HISTORY --- */
function showHistory() {
  const list = document.getElementById("history-list");
  list.innerHTML = "";
  if (!gameState.history.length) {
    list.innerHTML = "<div>No transactions yet.</div>";
  } else {
    gameState.history.slice().reverse().forEach(tx => {
      const date = new Date(tx.timestamp).toLocaleString();
      if (tx.type === "hint") {
        list.innerHTML += `<div class="history-item">[${date}] Hint at Level ${tx.level} - Used <b>10 $EARM</b></div>`;
      } else if (tx.type === "level-up") {
        list.innerHTML += `<div class="history-item">[${date}] Level Cleared: ${tx.level} - Rewarded <b>${tx.amount} $EARM</b></div>`;
      }
    });
  }
  list.style.display = "block";
}

/* --- BUTTON EVENTS --- */
document.getElementById("history-btn").onclick = function() {
  showHistory();
};
document.getElementById("restart-btn").onclick = function() {
  if (confirm("Restart the game? All progress will be lost!")) {
    resetGame();
  }
};

/* --- INIT --- */
window.onload = function() {
  loadGame();
  renderGame();
  // Listen for mining balance updates in index.html (optional)
  window.addEventListener("earm_mining_update", function() {
    document.getElementById("mining-balance-value").textContent = gameState.mining.toLocaleString();
  });
};

</script>
</body>
</html>
